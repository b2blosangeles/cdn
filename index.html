<!DOCTYPE html>
<html lang="en">
<head>
   <script src="/js/socket.io-1.4.5.js"></script>
   <script src="http://qalet.com/js/jquery.min.js"></script>
</head>

<body>
 <div id="UploadBox">
        <h2>Video Uploader</h2>
        <span id='UploadArea'>
               <form id="uploadform" method="POST" enctype="multipart/form-data" target="niu1">
                <input type="file" name="filefield"><br />
                <input type="submit">
                <input type="button" onClick="vv()">
              </form>
              <div id="progress_bar"></div>
               <iframe name="niu1" style="display:none"></iframe> 
		<hr>
		<div id="video_list"></div>
        </span>
    </div>	
    <div class="income_msg"></div>
</body>
</html>
<script>
	function  loadList() {
		$.ajax({
		  url: 'http://vr.qalet.com/api/showvideolist.js',
		  data: {},
		  success: function(data) {
			var s = '';
			for (var i=0; i< data.length; i++) {
				s += data[i]+' '	
			}	
			$('.video_list').html = s;  
		  },
		  dataType: 'JSON'
		});	
	}	
	
	
	var qaletSocket = io.connect('/');
	
	    qaletSocket.on('connect', function(data) {
		// document.getElementById('uploadform').action='/api/test.js?socket_id=' + qaletSocket.id;
		loadList();
	      //  http://localhost:4200/
	      //  socket.emit('join', 'Hello World from client -->' + socket.id);
	    });

	setInterval(function() {
	//	qaletSocket.emit('IM', {from: qaletSocket.id, to: qaletSocket.id, message:'Hello World from client', sent:new Date()});
	}, 1000);
	
	
    qaletSocket.on('message', function(data) {
	    if (data.code == 'progress') {
	    	 $('.income_msg').html(data.bytes );
	    } else {
	    	 $('.income_msg').html(JSON.stringify(data) + '<hr>' + $('.income_msg').html() );
	    }
	
	    /*
		console.log('message in --->' + qaletSocket.id);
		console.log(data);
		console.log('after message in--->');
		*/
    });

</script>
