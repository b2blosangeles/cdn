<!DOCTYPE html>
<html lang="en">
<head>
   <link rel="stylesheet" href="http://qalet.com/css/font-awesome-4.6.3/css/font-awesome.min.css">		
   <script src="/js/socket.io-1.4.5.js"></script>
   <script src="http://qalet.com/js/jquery.min.js"></script>
	
</head>

<body>
 <div id="UploadBox">
        <h2>Video Uploader</h2>
        <span id='UploadArea'>
               <form id="uploadform" method="POST" enctype="multipart/form-data" target="niu1">
                <input type="file" name="filefield">&nbsp;&nbsp;&nbsp;
                <input type="submit">
              </form>
              <div id="progress_bar"></div>
               <iframe name="niu1" style="display:none"></iframe> 
		<div class="income_msg"></div>
		<hr>
		<div class="video_list"></div>
        </span>
    </div>	
</body>
</html>
<script>
	var qaletSocket = io.connect('/');
	function  loadList() {
		$.ajax({
		  url: 'http://vr.qalet.com/api/showvideolist.js?socket_id=' + qaletSocket.id,
		  data: {},
		  success: function(data) {
			var s = '';
			for (var i=0; i< data.length; i++) {
				s += '<br/><a href="/api/showvideo.js?video='+data[i]+'" target="_blank">' + data[i]+'</a> ';	
				s += '<a href="JavaScript:void(0)" onClick="deleteVideo(\''+data[i]+'\')"><i class="fa fa-trash-o" aria-hidden="true"></i><a>';
				s += '<br/>';
			}	
			$('.video_list').html(s);  
		  },
		  dataType: 'JSON'
		});	
	}	
	function  deleteVideo(v) {
		$.ajax({
		  url: 'http://vr.qalet.com/api/deleteVideo.js',
		  data: {video_id:v},
		  success: function(data) {
			console.log(data);  
 			loadList();
		  },
		  dataType: 'JSON'
		});	
	}		
	
	
	
	    qaletSocket.on('connect', function(data) {
		document.getElementById('uploadform').action='/api/test.js?socket_id=' + qaletSocket.id;
		loadList();
	      //  http://localhost:4200/
	      //  socket.emit('join', 'Hello World from client -->' + socket.id);
	    });


    qaletSocket.on('message', function(data) {
	    if (data.code == 'progress') {
	    	 $('.income_msg').html(data.bytes );
	    } else {
	    	if (data.code == 'js') {
		   data.js();	
		} else {
		 	loadList();	
		}	
	    }
    });

</script>
